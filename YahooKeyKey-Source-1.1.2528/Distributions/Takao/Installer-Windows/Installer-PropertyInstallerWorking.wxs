<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: 
    lightArgs: -out "<projectname>.msi" "ykeykey.wixobj" "C:\Program Files\Windows Installer XML\bin\wixui.wixlib" -loc "wixui_zh-tw.wxl
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2003/01/wi">
  <Product Id="2827060E-6261-4C5F-A985-514400D45EFA" Name="Yahoo! 奇摩輸入法 1.0 beta 2 (build 1500)" Language="1028" Version="1.0.1500" Manufacturer="Yahoo! Inc." Codepage="950" UpgradeCode="383FA4DD-AAF4-45F0-9694-A7F6D1A5B5C7">
    <Package Id="0B3D36B4-D919-FC5A-BCFE-62910D607EE3" Description="Yahoo! KeyKey Input Method" Comments="The main package of the Yahoo! KeyKey Input Method" InstallerVersion="200" Compressed="yes" Manufacturer="Yahoo Inc." />
    <Condition Message="You need to be an administrator to install this product.">Privileged</Condition>
    <Condition Message="You need to be an administrator to install this product.">AdminUser</Condition>
    <Condition Message="This application requires Windows XP or higher version.">VersionNT</Condition>
    <Condition Message="This setup requires the .NET Framework 2.0 or higher">MsiNetAssemblySupport &gt;= "2.0.50727"</Condition>
    <Condition Message="$(loc.Condition_DisallowsDowngrading)">NOT NEWERVERSIONFOUND</Condition>
    <Property Id="INSTALLDIR">
      <RegistrySearch Id="KeyKeyServerLocation" Type="raw" Root="HKLM" Key="SOFTWARE\Yahoo\KeyKey" Name="ServerLocation" />
    </Property>
    <Property Id="ARPPRODUCTICON" Value="Product.ico" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <Binary Id="ServerShooter" SourceFile="Binary\ServerShooter.dll" />
    <UIRef Id="WixUI_InstallDir" />
    <Media Id="1" Cabinet="Product.cab" EmbedCab="yes" />
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Merge Id="CRT" Language="0" SourceFile="c:\Program Files\Common Files\Merge Modules\microsoft_vc80_crt_x86.msm" DiskId="1" />
      <Merge Id="CRT Policy" Language="0" SourceFile="c:\Program Files\Common Files\Merge Modules\policy_8_0_Microsoft_VC80_CRT_x86.msm" DiskId="1" />
      <Directory Id="ProgramFilesFolder">
        <Directory Id="YAHOO" Name="Yahoo!">
          <Directory Id="INSTALLDIR" Name="KeyKey">
            <Component Id="ServerComponent" Guid="2C4C71D9-E0AE-46C4-8D0A-1CFE820923C5">
              <File Id="SERVER" Name="SERVER.EXE" LongName="KeyKeyServer.exe" DiskId="1" Vital="yes" Source="..\..\..\release\obfuscated\KeyKeyServer.exe" />
              <File Id="TOOL" Name="TOOL.EXE" Source="..\..\..\release\KeyKeyTool.exe" LongName="KeyKeyTool.exe" Vital="yes" DiskId="1" />
              <File Id="UI" Name="KEYKEYUI.DLL" LongName="KeyKeyUI.dll" Source="..\..\..\release\obfuscated\KeyKeyUI.dll" Vital="yes" DiskId="1" />
              <File Id="PREFERENCE" Name="PREF.DLL" LongName="Preference.dll" Source="..\..\..\release\obfuscated\Preference.dll" Vital="yes" DiskId="1" />
              <File Id="ServiceUI.exe" Name="SrvUI.exe" DiskId="1" Source="..\..\..\release\obfuscated\ServiceUI.exe" Vital="yes" LongName="ServiceUI.exe" />
              <File Id="QuickSetup.exe" Name="QSetup.exe" DiskId="1" LongName="QuickSetup.exe" Source="..\..\..\release\obfuscated\QuickSetup.exe" Vital="yes" />
              <Registry Id="KeyKeyInstallDir" Root="HKLM" Key="SOFTWARE\Yahoo\KeyKey" Name="ServerLocation" Action="write" Type="string" Value="[INSTALLDIR]" />
              <Registry Action="write" Id="LaunchOnBoot" Name="KeyKeyServer" Root="HKLM" Type="string" Value="&quot;[INSTALLDIR]KeyKeyServer.exe&quot;" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Run" />
              <Registry Id="RemoveKeyKeyInstallDir" Root="HKLM" Key="SOFTWARE\Yahoo\KeyKey" Action="removeKeyOnUninstall" />
              <Registry Id="KeyKeyVersion" Name="Version" Type="string" Value="1.0.1500" Key="SOFTWARE\Yahoo\KeyKey" Action="write" Root="HKLM" />
            </Component>
            <Directory Id="ZHTW" Name="zh-TW">
              <Component Id="zhTW" Guid="12859372-5591-4AE6-BB0D-43B5C68AEECE">
                <File Id="UIRESX" Name="UIRESX.DLL" DiskId="1" LongName="KeyKeyUI.resources.dll" Source="..\..\..\release\obfuscated\zh-TW\KeyKeyUI.resources.dll" Vital="yes" />
                <File Id="PREFRESX" Name="PREFRESX.DLL" DiskId="1" LongName="Preference.resources.dll" Source="..\..\..\release\obfuscated\zh-TW\Preference.resources.dll" Vital="yes" />
                <File Id="QSRESX" Name="QSRESX.DLL" LongName="QuickSetup.resources.dll" Source="..\..\..\release\obfuscated\zh-TW\QuickSetup.resources.dll" DiskId="1" Vital="yes" />
              </Component>
            </Directory>
            <Directory Id="Databases" LongName="Databases" Name="Database">
              <Component Id="DATABASE" Guid="460172E5-009E-4621-8DEF-44681E36796E">
                <File Id="KEYKEYDB" Name="KEYKEY.DB" DiskId="1" LongName="KeyKey.db" CompanionFile="KeyKey.ime" Source="..\CookedDatabase\KeyKey.db" Vital="yes" />
              </Component>
            </Directory>
            <Directory Id="WEBUI" Name="WebUI">
              <Component Id="WebUI" Guid="4E2A6F90-07F4-41CB-B631-EF58A0C137B9">
                <File Id="enter.gif" Name="enter.gif" Source="..\..\..\WebResources\enter.gif" Vital="yes" DiskId="1" />
                <File Id="loading.gif" Name="loading.gif" DiskId="1" Source="..\..\..\WebResources\loading.gif" Vital="yes" />
              </Component>
            </Directory>
            <Directory Id="ZHCN" Name="zh-CN">
              <Component Id="zhCN" Guid="71B76FB4-6BCF-4B8A-AF0D-FF5F88C79907">
                <File Id="UIRESXCN" Name="UIRESX.DLL" DiskId="1" LongName="KeyKeyUI.resources.dll" src="..\..\..\release\obfuscated\zh-CN\KeyKeyUI.resources.dll" Vital="yes" />
                <File Id="PREFRESXCN" Name="PREFRESX.DLL" DiskId="1" LongName="Preference.resources.dll" src="..\..\..\release\obfuscated\zh-CN\Preference.resources.dll" Vital="yes" />
                <File Id="QSRESXCN" Name="QSRESX.DLL" DiskId="1" LongName="QuickSetup.resources.dll" src="..\..\..\release\obfuscated\zh-CN\QuickSetup.resources.dll" Vital="yes" />
              </Component>
            </Directory>
          </Directory>
        </Directory>
      </Directory>
      <Directory Id="SystemFolder">
        <Component Id="IME" Guid="9AAE9A47-1244-4036-BF05-69ACA9D43B88">
          <File Id="KeyKey.ime" Name="KeyKey.ime" DiskId="1" Source="..\..\..\release\KeyKey.ime" Vital="yes" />
        </Component>
      </Directory>
    </Directory>
    <Feature Id="Complete" Title="Yahoo! KeyKey 1.0" Description="The complete package." Display="expand" Level="1" ConfigurableDirectory="INSTALLDIR" TypicalDefault="install" Absent="disallow" InstallDefault="local" AllowAdvertise="no">
      <MergeRef Id="CRT" />
      <MergeRef Id="CRT Policy" />
      <Feature Id="Program" Title="Program files" Level="1" InstallDefault="local" AllowAdvertise="no" Absent="disallow" Description="The program files.">
        <ComponentRef Id="ServerComponent" />
        <ComponentRef Id="zhTW" />
        <ComponentRef Id="DATABASE" />
        <ComponentRef Id="WebUI" />
        <ComponentRef Id="IME" />
        <ComponentRef Id="zhCN" />
      </Feature>
    </Feature>
    <AdminExecuteSequence />
    <InstallUISequence>
      <Custom Action="InstallerBeginBeacon" After="FindRelatedProducts" />
      <Custom Action="DisallowsDowngrading" After="FindRelatedProducts">NEWERVERSIONFOUND</Custom>
    </InstallUISequence>
    <InstallExecuteSequence>
      <Custom Action="DisallowsDowngrading" After="FindRelatedProducts">NEWERVERSIONFOUND</Custom>
      <Custom Action="ShutdownServerProcess" Before="InstallValidate" />
      <Custom Action="UnregisterIME" After="InstallValidate">REMOVE OR MaintenanceMode="Remove"</Custom>
			<Custom Action="CleanPropertyInstallerSignalFile" After="InstallFinalize"></Custom>			
      <Custom Action="QuickSetup" After="InstallFinalize">$ServerComponent &gt; 2</Custom>
	    <Custom Action="CheckPropertyInstallerSignalFile" After="InstallFinalize">$ServerComponent &gt; 2</Custom>
      <Custom Action="RegisterIME" After="InstallFinalize">$ServerComponent &gt; 2</Custom>
      <Custom Action="InstallerEndBeacon" After="InstallFinalize">$ServerComponent &gt; 2</Custom>
      <ScheduleReboot After="InstallFinalize">CALLPROPERTYINSTALLER &lt; 1</ScheduleReboot>
      <RemoveExistingProducts After="InstallInitialize">PREVIOUSVERSIONFOUND</RemoveExistingProducts>
    </InstallExecuteSequence>
    <Binary Id="bannrbmp" src="Binary\bannrbmp.bmp" />
    <Binary Id="completi" src="Binary\completi.ico" />
    <Binary Id="custicon" src="Binary\custicon.ico" />
    <Binary Id="dlgbmp" src="Binary\dlgbmp.bmp" />
    <Binary Id="exclamic" src="Binary\exclamic.ico" />
    <Binary Id="info" src="Binary\info.ico" />
    <Binary Id="insticon" src="Binary\insticon.ico" />
    <Binary Id="New" src="Binary\New.ico" />
    <Binary Id="removico" src="Binary\removico.ico" />
    <Binary Id="repairic" src="Binary\repairic.ico" />
    <Binary Id="Up" src="Binary\Up.ico" />
    <Binary Id="WinBeacon" src="..\WinBeacon\bin\Release\WinBeacon.exe" />
    <CustomAction Id="InstallerBeginBeacon" BinaryKey="WinBeacon" ExeCommand="begin" Return="asyncNoWait" />
    <CustomAction Id="DisallowsDowngrading" Error="$(loc.Condition_DisallowsDowngrading)" />
    <CustomAction Id="RegisterIME" FileKey="TOOL" ExeCommand="install [SystemFolder]\KeyKey.ime" Return="ignore" />
    <CustomAction Id="UnregisterIME" FileKey="TOOL" ExeCommand="uninstall KeyKey.ime" Return="ignore" />
    <CustomAction Id="QuickSetup" FileKey="QuickSetup.exe" ExeCommand="" Return="ignore" />
    <CustomAction Id="ShutdownServerProcess" BinaryKey="ServerShooter" DllEntry="Shutdown" Return="ignore" />
    <CustomAction Id="CleanPropertyInstallerSignalFile" BinaryKey="ServerShooter" DllEntry="CleanPropertyInstallerSignalFile" Return="check" />
    <CustomAction Id="CheckPropertyInstallerSignalFile" BinaryKey="ServerShooter" DllEntry="CheckPropertyInstallerSignalFile" Return="check" />
    <CustomAction Id="InstallerEndBeacon" BinaryKey="WinBeacon" ExeCommand="end" Return="asyncNoWait" />
    <UI />
    <Icon Id="Product.ico" SourceFile="Binary\Product.ico" />
    <Upgrade Id="383FA4DD-AAF4-45F0-9694-A7F6D1A5B5C7">
      <UpgradeVersion OnlyDetect="no" Property="PREVIOUSVERSIONFOUND" Maximum="1.0.1500" IncludeMaximum="no" />
      <UpgradeVersion OnlyDetect="yes" Property="NEWERVERSIONFOUND" Minimum="1.0.1500" IncludeMinimum="no" />
    </Upgrade>
  </Product>
</Wix>
